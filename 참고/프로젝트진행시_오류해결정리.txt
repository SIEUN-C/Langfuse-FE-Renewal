오류 해결 과정 정리해두기

*** langfuse 로컬 접속 오류 해결
- 오류 상황 
docker compose up 명령어를 실행했지만 localhost:3000으로 접속이 안되고, 터미널에는 에러 메시지만 계속 출력되는 상황.
- 문제 파악
1. docker compose ps 명령어로 컨테이너들 상태 확인
	- 발견 문제 : 다른 모든 컨테이너(postgres, ridis 등)는 up(healthy) 상태로 잘 동작함. / 웹사이트를 담당하는 langfuse-web-1 컨테이너만 Restarting(재시작 중) 상태
	- 분석 : Restarting 상태는 '컨테이너가 켜지자마자 에러가 발생해서 꺼지고, 도커가 그걸 다시 켜러고 시도하는 무한 루프'에 빠졌다는 의미

- 원인 추적
2. docker compose logs langfuse-web 명령어로 컨테이너의 내부기록 확인하기(langfuse-web 컨테이너가 왜 계속 죽는지 확인)
	- 발견 문제 : 로그 마지막에 에러메세지가 반복적으로 찍혀있음
	error: failed to open database: dial tcp [::1]:9000: connect: connection refused
	- 분석 : 이 에러는 langfuse-web이 [ : : 1]:9000 주소로 데이터베이스 연결을 시도하다가 거부당했다는 의미
	-> [ : : 1]은 localhost, 즉 자기자신을 가리키는 주소
	-> 9000번 포트는 clickhouse라는 다른 데이터베이스 컨테이너가 사용하는 포트
	-> 종합하면, langfuse-web 컨테이너가 동료인 clickhouse를 찾아가지 못하고 엉뚱하게 자기 자신에게 연결을 시도하다가 실패하고 있던 것

- 해결방안 1
1. 처음에는 데이터가 꼬였거나, clickhouse 컨테이너가 준비되기 전에 langfuse-web이 너무 빨리 실행되는 '시간차 문제' 일 것이라 생각해서 다음과 같이 시도
	-> 단순 재시작(docker compose restart ...): 실패.
	-> 데이터 포함 완전 삭제 후 재시작 (docker compose down -v): 이것은 가장 강력한 초기화 방법임에도 불구하고 또다시 실패
결론 : 일시적인 오류나 데이터 꼬임 문제가 아니라, 몇 번을 재시도해도 똑같은 결과를 낳는 '설정(Configuration)'의 문제라는 것

- 해결방안 2(최종원인 발견 및 해결)
2. langfuse-web이 참조하는 설정파일(.env)이 문제 원인임
문제 : - `.env` 파일 안에 있는 모든 데이터베이스와 서비스들의 주소가 아래와 같이 `localhost`로 설정되어 있었음.
    
    `DATABASE_URL="postgresql://... @localhost:5432/..."
    CLICKHOUSE_MIGRATION_URL="clickhouse://localhost:9000"
    REDIS_HOST="127.0.0.1"
    ...`
    
    이 설정은 Docker **밖에서** 직접 프로그램을 실행할 때나 쓰는 방식임. Docker 환경에서는 각 컨테이너(서비스)의 이름이 곧 주소 역할을 함.

해결책 : - `.env` 파일의 `localhost` 또는 `127.0.0.1`로 된 모든 주소를 실제 Docker 서비스 이름으로 아래와 같이 변경함.
    
    `DATABASE_URL="postgresql://... @postgres:5432/..."
    CLICKHOUSE_MIGRATION_URL="clickhouse://clickhouse:9000"
    REDIS_HOST="redis"
    ...`
    
    이렇게 주소 변경, `langfuse-web` 컨테이너는 동료 컨테이너들을 제대로 찾아가서 연결에 성공했고, 더 이상 재시작 루프에 빠지지 않고 정상적으로 실행함.

- 요약 
"Docker 환경에 맞지 않는 localhost 주소가 설정 파일(.env)에 잘못 들어가 있어서, 웹 서버 컨테이너가 데이터베이스 컨테이너를 찾지 못하고 계속 재시작하는 문제" 였고, 이 주소들을 Docker의 서비스 이름으로 올바르게 수정하여 해결함.












